@layer theme, base, components, utilities;

@import "tailwindcss";
@import "@xyflow/react/dist/style.css" layer(base);
@import "./components/index.css" layer(components);
@import "./theme.css" layer(theme);

@plugin 'tailwindcss-animate';

@source '../**/*.{js,ts,jsx,tsx,mdx}';

@custom-variant dark (&:is(.dark *));

/* 
 * Tailwind Theme Extensions - Unique tokens not defined in theme.css
 * Core color mappings, radius, easing, and derived colors are in theme.css
 */
@theme inline {
    /* Blur extension */
    --backdrop-blur-xs: 2px;

    /* Base radius value (used by theme.css for calculations) */
    --radius: 0.5rem;
    --field-radius: calc(var(--radius) * 1.5);

    /* Interactive cursor */
    --cursor-interactive: pointer;

    /* Border width for fields */
    --border-width-field: 0px;

    /* Animation durations */
    --duration-150: 150ms;
    --duration-200: 200ms;
    --duration-250: 250ms;
    --duration-300: 300ms;

    /* Gradient utilities */
    --background-image-gradient-radial: radial-gradient(var(--tw-gradient-stops));
    --background-image-gradient-conic: conic-gradient(from 180deg at 50% 50%, var(--tw-gradient-stops));

    /* Custom size extensions */
    --width-128: 32rem;
    --width-176: 44rem;
    --width-208: 52rem;
    --height-128: 32rem;
    --height-160: 40rem;
    --height-176: 44rem;

    /* shadcn-compatible tokens (kept for backward compatibility) */
    --color-popover: var(--popover);
    --color-popover-foreground: var(--popover-foreground);
    --color-primary: var(--primary);
    --color-primary-foreground: var(--primary-foreground);
    --color-primary-hover: var(--primary-hover);
    --color-secondary: var(--secondary);
    --color-secondary-foreground: var(--secondary-foreground);
    --color-secondary-hover: var(--secondary-hover);
    --color-muted-foreground: var(--muted-foreground);
    --color-destructive: var(--destructive);
    --color-destructive-foreground: var(--destructive-foreground);
    --color-destructive-hover: var(--destructive-hover);
    --color-destructive-soft: var(--destructive-soft);
    --color-input: var(--input);
    --color-ring: var(--ring);

    /* Chart colors */
    --color-chart-1: var(--chart-1);
    --color-chart-2: var(--chart-2);
    --color-chart-3: var(--chart-3);
    --color-chart-4: var(--chart-4);
    --color-chart-5: var(--chart-5);

    /* Node-specific colors */
    --color-nodes-claimsexchange: var(--nodes-claims-exchange);
    --color-nodes-combinedsigninup: var(--nodes-combined-signinup);
    --color-nodes-group: var(--nodes-group);
    --color-nodes-group-border: var(--nodes-group-border);
}

/* Status utilities as @utility for @apply support */
@utility status-focused {
    --tw-ring-offset-width: 2px;
    --tw-ring-offset-color: var(--color-background);
    --tw-ring-color: var(--color-ring);
    --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);
    --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);
    box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000);
    outline: none;
}

@utility status-focused-field {
    --tw-ring-color: color-mix(in oklch, var(--color-ring) 50%, transparent);
    --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);
    --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);
    box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000);
    outline: none;
}

@utility status-disabled {
    pointer-events: none;
    opacity: 0.5;
    cursor: not-allowed;
}

@utility status-pending {
    pointer-events: none;
    cursor: wait;
}

@utility status-invalid-field {
    --tw-ring-color: color-mix(in oklch, var(--color-destructive) 20%, transparent);
    --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);
    --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);
    box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000);
}

@utility no-highlight {
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
}

@layer utilities {
    :root {
        --foreground-rgb: 0, 0, 0;
        --background-start-rgb: 214, 219, 220;
        --background-end-rgb: 255, 255, 255;
    }

    .bg-grid-pattern {
        background-image:
            linear-gradient(to right, var(--grid-line-color, currentColor) 1px, transparent 1px),
            linear-gradient(to bottom, var(--grid-line-color, currentColor) 1px, transparent 1px);
        background-size: var(--grid-size, 40px) var(--grid-size, 40px);
    }

    .origin-0 {
        transform-origin: 0%;
    }

    .collapsible-content {
        @apply overflow-hidden
        data-[state=open]:animate-in data-[state=closed]:animate-out
        data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0
        data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95
        data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2
        data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2;
    }
}

@layer components {
    body,
    html {
        height: 100%;
    }

    li {
        @apply ml-6 list-disc;
    }
}

@layer base {
    :root,
    .light,
    [data-theme="light"] {
        --theme-accent: oklch(62.06% 0.1742 250.36);
        --theme-accent-foreground: oklch(99.11% 0 0);
        --theme-background: oklch(97.02% 0.0132 250.36);
        --theme-border: oklch(90% 0.0132 250.36);
        --theme-danger: oklch(65.32% 0.2389 25.32);
        --theme-danger-foreground: oklch(99.11% 0 0);
        --theme-default: oklch(94% 0.0132 250.36);
        --theme-default-foreground: oklch(21.03% 0.0059 250.36);
        --theme-field-background: oklch(100% 0.0066 250.36);
        --theme-field-foreground: oklch(21.03% 0.0059 250.36);
        --theme-field-placeholder: oklch(55.17% 0.0264 250.36);
        --theme-focus: oklch(62.06% 0.1742 250.36);
        --theme-foreground: oklch(21.03% 0.0059 250.36);
        --theme-muted: oklch(55.17% 0.0264 250.36);
        --theme-overlay: oklch(100% 0.004 250.36);
        --theme-overlay-foreground: oklch(21.03% 0.0059 250.36);
        --theme-scrollbar: oklch(87.1% 0.0132 250.36);
        --theme-segment: oklch(100% 0.0132 250.36);
        --theme-segment-foreground: oklch(21.03% 0.0059 250.36);
        --theme-separator: oklch(92% 0.0132 250.36);
        --theme-success: oklch(73.29% 0.1986 150.39);
        --theme-success-foreground: oklch(21.03% 0.0059 150.39);
        --theme-surface: oklch(100% 0.0066 250.36);
        --theme-surface-foreground: oklch(21.03% 0.0059 250.36);
        --theme-warning: oklch(78.19% 0.1627 71.91);
        --theme-warning-foreground: oklch(21.03% 0.0059 71.91);

        --theme-accent-hover: color-mix(in oklch, var(--theme-accent) 85%, black);
        --theme-accent-soft: color-mix(in oklch, var(--theme-accent) 15%, var(--theme-background));
        --theme-accent-soft-hover: color-mix(in oklch, var(--theme-accent) 22%, var(--theme-background));
        --theme-default-hover: color-mix(in oklch, var(--theme-default) 85%, black);
        --theme-danger-hover: color-mix(in oklch, var(--theme-danger) 85%, black);
        --theme-danger-soft: color-mix(in oklch, var(--theme-danger) 12%, var(--theme-background));
        --theme-danger-soft-hover: color-mix(in oklch, var(--theme-danger) 18%, var(--theme-background));
        --theme-success-hover: color-mix(in oklch, var(--theme-success) 85%, black);
        --theme-success-soft: color-mix(in oklch, var(--theme-success) 15%, var(--theme-background));
        --theme-warning-hover: color-mix(in oklch, var(--theme-warning) 85%, black);
        --theme-warning-soft: color-mix(in oklch, var(--theme-warning) 15%, var(--theme-background));
        --theme-surface-secondary: color-mix(in oklch, var(--theme-surface) 95%, var(--theme-foreground));
        --theme-surface-tertiary: color-mix(in oklch, var(--theme-surface) 90%, var(--theme-foreground));

        --background: var(--theme-background);
        --foreground: var(--theme-foreground);
        --primary: var(--theme-accent);
        --primary-foreground: var(--theme-accent-foreground);
        --primary-hover: var(--theme-accent-hover);
        --secondary: var(--theme-default);
        --secondary-foreground: var(--theme-default-foreground);
        --secondary-hover: var(--theme-default-hover);
        --muted: var(--theme-muted);
        --muted-foreground: var(--theme-muted);
        --accent: var(--theme-accent);
        --accent-foreground: var(--theme-accent-foreground);
        --destructive: var(--theme-danger);
        --destructive-foreground: var(--theme-danger-foreground);
        --destructive-hover: var(--theme-danger-hover);
        --destructive-soft: var(--theme-danger-soft);
        --card: var(--theme-surface);
        --card-foreground: var(--theme-surface-foreground);
        --popover: var(--theme-overlay);
        --popover-foreground: var(--theme-overlay-foreground);
        --border: var(--theme-border);
        --input: var(--theme-border);
        --ring: var(--theme-focus);
        --separator: var(--theme-separator);

        --default: var(--theme-default);
        --default-foreground: var(--theme-default-foreground);
        --surface: var(--theme-surface);
        --surface-foreground: var(--theme-surface-foreground);
        --overlay: var(--theme-overlay);
        --overlay-foreground: var(--theme-overlay-foreground);
        --danger: var(--theme-danger);
        --danger-foreground: var(--theme-danger-foreground);
        --focus: var(--theme-focus);
        --link: var(--theme-accent);

        --surface-shadow:
            0px 0px 1px 0px rgb(0 0 0 / 0.04), 0px 2px 6px 0px rgb(0 0 0 / 0.04), 0px 10px 20px 0px rgb(0 0 0 / 0.04);
        --overlay-shadow:
            0px 0px 1px 0px rgb(0 0 0 / 0.06), 0px 4px 12px 0px rgb(0 0 0 / 0.08), 0px 16px 32px 0px rgb(0 0 0 / 0.08);
        --field-shadow: 0px 2px 4px 0px rgb(0 0 0 / 0.06);
        --border-width: 1px;

        /* New semantic tokens */
        --success: var(--theme-success);
        --success-foreground: var(--theme-success-foreground);
        --warning: var(--theme-warning);
        --warning-foreground: var(--theme-warning-foreground);
        --field-background: var(--theme-field-background);
        --field-foreground: var(--theme-field-foreground);
        --field-placeholder: var(--theme-field-placeholder);
        --segment: var(--theme-segment);
        --segment-foreground: var(--theme-segment-foreground);
        --scrollbar: var(--theme-scrollbar);

        /* Chart colors */
        --chart-1: oklch(62% 0.19 25);
        --chart-2: oklch(65% 0.15 173);
        --chart-3: oklch(50% 0.1 250);
        --chart-4: oklch(75% 0.15 85);
        --chart-5: oklch(70% 0.18 30);

        /* Node-specific tokens */
        --nodes-combined-signinup: oklch(99.5% 0 0);
        --nodes-claims-exchange: oklch(90% 0.05 220);
        --nodes-group: oklch(95% 0 0);
        --nodes-group-border: oklch(85% 0.02 250);

        /* Flow minimap tokens */
        --flow-minimap-mask: color-mix(in oklch, var(--background) 82%, transparent);
        --flow-minimap-mask-stroke: oklch(20% 0.02 250 / 0.25);
        --flow-minimap-node-surface: var(--card);
        --flow-minimap-node-outline: var(--border);
        --flow-minimap-node-accent: var(--primary);
        --flow-minimap-node-detail: color-mix(in oklch, var(--foreground) 40%, transparent);
        --flow-minimap-group-stroke: var(--nodes-group-border);
        --flow-minimap-group-accent: var(--nodes-group-border);
    }

    .dark,
    [data-theme="dark"] {
        color-scheme: dark;

        /* ═══════════════════════════════════════════════════════════════════════
           HeroUI Theme Colors - Dark Mode
           @see https://v3.heroui.com/docs/react/getting-started/theming
           ═══════════════════════════════════════════════════════════════════════ */
        --theme-accent: oklch(62.06% 0.1742 250.36);
        --theme-accent-foreground: oklch(99.11% 0 0);
        --theme-background: oklch(12% 0.0132 250.36);
        --theme-border: oklch(28% 0.0132 250.36);
        --theme-danger: oklch(59.4% 0.2019 24.21);
        --theme-danger-foreground: oklch(99.11% 0 0);
        --theme-default: oklch(27.4% 0.0132 250.36);
        --theme-default-foreground: oklch(99.11% 0 0);
        --theme-field-background: oklch(21.03% 0.0264 250.36);
        --theme-field-foreground: oklch(99.11% 0 0);
        --theme-field-placeholder: oklch(70.5% 0.0264 250.36);
        --theme-focus: oklch(62.06% 0.1742 250.36);
        --theme-foreground: oklch(99.11% 0 0);
        --theme-muted: oklch(70.5% 0.0264 250.36);
        --theme-overlay: oklch(21.03% 0.0264 250.36);
        --theme-overlay-foreground: oklch(99.11% 0 0);
        --theme-scrollbar: oklch(70.5% 0.0132 250.36);
        --theme-segment: oklch(39.64% 0.0132 250.36);
        --theme-segment-foreground: oklch(99.11% 0 0);
        --theme-separator: oklch(25% 0.0132 250.36);
        --theme-success: oklch(73.29% 0.1986 150.39);
        --theme-success-foreground: oklch(21.03% 0.0059 150.39);
        --theme-surface: oklch(21.03% 0.0264 250.36);
        --theme-surface-foreground: oklch(99.11% 0 0);
        --theme-warning: oklch(82.03% 0.1425 75.92);
        --theme-warning-foreground: oklch(21.03% 0.0059 75.92);

        /* ═══════════════════════════════════════════════════════════════════════
           Derived Colors (auto-calculated from theme tokens)
           ═══════════════════════════════════════════════════════════════════════ */
        --theme-accent-hover: color-mix(in oklch, var(--theme-accent) 80%, white);
        --theme-accent-soft: color-mix(in oklch, var(--theme-accent) 20%, var(--theme-background));
        --theme-accent-soft-hover: color-mix(in oklch, var(--theme-accent) 28%, var(--theme-background));
        --theme-default-hover: color-mix(in oklch, var(--theme-default) 80%, white);
        --theme-danger-hover: color-mix(in oklch, var(--theme-danger) 80%, white);
        --theme-danger-soft: color-mix(in oklch, var(--theme-danger) 18%, var(--theme-background));
        --theme-danger-soft-hover: color-mix(in oklch, var(--theme-danger) 25%, var(--theme-background));
        --theme-success-hover: color-mix(in oklch, var(--theme-success) 80%, white);
        --theme-success-soft: color-mix(in oklch, var(--theme-success) 20%, var(--theme-background));
        --theme-warning-hover: color-mix(in oklch, var(--theme-warning) 80%, white);
        --theme-warning-soft: color-mix(in oklch, var(--theme-warning) 20%, var(--theme-background));
        --theme-surface-secondary: color-mix(in oklch, var(--theme-surface) 90%, var(--theme-foreground));
        --theme-surface-tertiary: color-mix(in oklch, var(--theme-surface) 80%, var(--theme-foreground));

        /* Application tokens automatically inherit from theme tokens */

        /* Chart colors - adjusted for dark mode */
        --chart-1: oklch(60% 0.18 250);
        --chart-2: oklch(60% 0.15 160);
        --chart-3: oklch(70% 0.16 50);
        --chart-4: oklch(65% 0.16 300);
        --chart-5: oklch(65% 0.18 350);

        /* Node-specific tokens - dark mode */
        --nodes-combined-signinup: oklch(8% 0 0);
        --nodes-claims-exchange: oklch(30% 0.04 220);
        --nodes-group: oklch(15% 0 0);
        --nodes-group-border: oklch(35% 0.02 250);

        /* Flow minimap tokens - dark mode */
        --flow-minimap-mask: color-mix(in oklch, var(--background) 60%, transparent);
        --flow-minimap-mask-stroke: oklch(100% 0 0 / 0.35);
        --flow-minimap-node-detail: color-mix(in oklch, var(--foreground) 60%, transparent);
    }

    /* https://reactflow.dev/learn/customization/theming */
    .react-flow {
        --xy-minimap-background-color: var(--background);
        --xy-background-color: transparent;
        --xy-minimap-node-background-color: var(--muted-foreground);
        --xy-attribution-background-color: var(--background);
        --xy-controls-button-background-color: var(--background);
        --xy-controls-button-border-color: var(--border);
        --xy-controls-button-background-color-hover: var(--accent);

        .react-flow__attribution {
            @apply rounded-md backdrop-blur-sm bg-background/30;
        }

        .react-flow__minimap-svg {
            @apply rounded-lg backdrop-blur-sm;
        }
    }

    .flow-minimap {
        @apply rounded-xl border bg-background/80 backdrop-blur-sm shadow-xl ring-1 ring-black/5;
        min-width: 11rem;
    }

    .flow-minimap svg {
        width: 12rem !important;
        height: 9.5rem !important;
    }

    .flow-minimap__shape {
        filter: drop-shadow(0 1px 3px rgba(15, 23, 42, 0.35));
    }

    .dark .flow-minimap__shape {
        filter: drop-shadow(0 1px 3px rgba(0, 0, 0, 0.65));
    }

    .flow-minimap__node text {
        font-family:
            "Inter",
            "Segoe UI",
            system-ui,
            -apple-system,
            BlinkMacSystemFont,
            sans-serif;
        letter-spacing: 0.02em;
    }
}

@layer base {
    * {
        @apply border-border;
    }

    body {
        @apply bg-background text-foreground;
        font-family:
            "Inter",
            ui-sans-serif,
            system-ui,
            -apple-system,
            BlinkMacSystemFont,
            "Segoe UI",
            Roboto,
            "Helvetica Neue",
            Arial,
            sans-serif;
        font-feature-settings: "cv02", "cv03", "cv04", "cv11";
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    /* Animation keyframes for components */
    @keyframes caret-blink {
        0%,
        70%,
        100% {
            opacity: 1;
        }
        20%,
        50% {
            opacity: 0;
        }
    }

    @keyframes spin-fast {
        from {
            transform: rotate(0deg);
        }
        to {
            transform: rotate(360deg);
        }
    }

    @keyframes skeleton {
        100% {
            transform: translateX(100%);
        }
    }

    @keyframes slot-value-in {
        0% {
            opacity: 0;
            transform: translateY(8px) scale(0.8);
        }
        100% {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }

    .animate-caret-blink {
        animation: caret-blink 1.25s ease-out infinite;
    }

    .animate-spin-fast {
        animation: spin-fast 0.6s linear infinite;
    }

    .animate-skeleton {
        animation: skeleton 2s ease-in-out infinite;
    }
}

/* fixes reactflow bug with no border on last child element */
.react-flow__controls-button:last-child {
    @apply border-b;
    border-bottom: 1px solid
        var(
            --xy-controls-button-border-color-props,
            var(--xy-controls-button-border-color, var(--xy-controls-button-border-color-default))
        );
}

.react-flow__edge-textbg {
    @apply fill-background/90 rounded-md p-4;
}

.react-flow__edge-text {
    @apply font-mono text-lg text-foreground backdrop-blur-sm m-4 bg-background;
}

/* Ensure edge labels render above everything */
.react-flow__edge-label-renderer {
    z-index: 1000 !important;
}

@utility h-screen-navbar {
    height: calc(100vh - var(--navbar-height));
}
@utility min-h-screen-navbar { min-height: calc(100vh - var(--navbar-height)); }
@utility max-h-screen-navbar { max-height: calc(100vh - var(--navbar-height)); }