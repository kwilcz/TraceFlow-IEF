@layer theme, base, components, utilities;

@import "tailwindcss";
@import "@xyflow/react/dist/style.css" layer(base);
@import "./components/index.css" layer(components);
@import "./theme.css" layer(theme);

@plugin 'tailwindcss-animate';

@source '../**/*.{js,ts,jsx,tsx,mdx}';

@custom-variant dark (&:is(.dark *));

@theme inline {
    --backdrop-blur-xs: 2px;

    --radius: 0.75rem;
    --field-radius: calc(var(--radius) * 1.5);

    --background-image-gradient-radial: radial-gradient(var(--tw-gradient-stops));
    --background-image-gradient-conic: conic-gradient(from 180deg at 50% 50%, var(--tw-gradient-stops));

    --width-128: 32rem;
    --width-176: 44rem;
    --width-208: 52rem;

    --height-128: 32rem;
    --height-160: 40rem;
    --height-176: 44rem;

    /* Core colors - map directly to CSS variables */
    --color-background: var(--background);
    --color-foreground: var(--foreground);

    --color-surface: var(--theme-surface);
    --color-surface-foreground: var(--theme-surface-foreground);

    --color-popover: var(--popover);
    --color-popover-foreground: var(--popover-foreground);

    --color-primary: var(--primary);
    --color-primary-foreground: var(--primary-foreground);

    --color-secondary: var(--secondary);
    --color-secondary-foreground: var(--secondary-foreground);

    --color-muted: var(--muted);
    --color-muted-foreground: var(--muted-foreground);

    --color-accent: var(--accent);
    --color-accent-foreground: var(--accent-foreground);

    --color-destructive: var(--destructive);
    --color-destructive-foreground: var(--destructive-foreground);

    --color-border: var(--border);
    --color-input: var(--input);
    --color-ring: var(--ring);

    /* New semantic colors */
    --color-success: var(--success);
    --color-success-foreground: var(--success-foreground);
    --color-warning: var(--warning);
    --color-warning-foreground: var(--warning-foreground);
    --color-separator: var(--separator);

    /* Field tokens */
    --color-field: var(--field-background);
    --color-field-foreground: var(--field-foreground);
    --color-field-placeholder: var(--field-placeholder);

    /* Segment tokens */
    --color-segment: var(--segment);
    --color-segment-foreground: var(--segment-foreground);

    /* Derived/hover colors */
    --color-primary-hover: var(--primary-hover);
    --color-secondary-hover: var(--secondary-hover);
    --color-destructive-hover: var(--destructive-hover);
    --color-destructive-soft: var(--destructive-soft);
    --color-accent-soft: var(--theme-accent-soft);
    --color-accent-soft-hover: var(--theme-accent-soft-hover);

    /* Chart colors */
    --color-chart-1: var(--chart-1);
    --color-chart-2: var(--chart-2);
    --color-chart-3: var(--chart-3);
    --color-chart-4: var(--chart-4);
    --color-chart-5: var(--chart-5);

    /* Node-specific colors */
    --color-nodes-claimsexchange: var(--nodes-claims-exchange);
    --color-nodes-combinedsigninup: var(--nodes-combined-signinup);
    --color-nodes-group: var(--nodes-group);
    --color-nodes-group-border: var(--nodes-group-border);
}

@layer utilities {
    :root {
        --foreground-rgb: 0, 0, 0;
        --background-start-rgb: 214, 219, 220;
        --background-end-rgb: 255, 255, 255;
    }

    .bg-grid-pattern {
        background-image:
            linear-gradient(to right, var(--grid-line-color, currentColor) 1px, transparent 1px),
            linear-gradient(to bottom, var(--grid-line-color, currentColor) 1px, transparent 1px);
        background-size: var(--grid-size, 40px) var(--grid-size, 40px);
    }

    .-z-1 {
        z-index: -1;
    }

    .origin-0 {
        transform-origin: 0%;
    }

    .btn-primary {
        @apply flex h-[48px] grow items-center justify-center gap-2 rounded-md bg-gray-50 p-3 text-sm font-medium hover:bg-sky-100 hover:text-blue-600 md:flex-none md:justify-start md:p-2 md:px-3;
    }

    .form-input-base {
        @apply pt-3 pb-2 block w-full px-0 mt-0 bg-transparent border-0 border-b-2 appearance-none focus:outline-hidden focus:ring-0 focus:border-black border-gray-200;
    }

    .label-input-base {
        @apply absolute duration-300 top-3 text-gray-500;
    }

    .collapsible-content {
        @apply overflow-hidden
        data-[state=open]:animate-in data-[state=closed]:animate-out
        data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0
        data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95
        data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2
        data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2;
    }
}

@layer components {
    body,
    html {
        height: 100%;
    }

    li {
        @apply ml-6 list-disc;
    }
}

@layer base {
    /* Force override default tailwindcss border color */
    *,
    ::after,
    ::before,
    ::backdrop,
    ::file-selector-button {
        border-color: var(--border) !important;
    }

    :root,
    .light,
    [data-theme="light"] {
        /* ═══════════════════════════════════════════════════════════════════════
           HeroUI Theme Colors - Light Mode
           @see https://v3.heroui.com/docs/react/getting-started/theming
           ═══════════════════════════════════════════════════════════════════════ */
        --theme-accent: oklch(62.06% 0.1742 250.36);
        --theme-accent-foreground: oklch(99.11% 0 0);
        --theme-background: oklch(97.02% 0.0132 250.36);
        --theme-border: oklch(90% 0.0132 250.36);
        --theme-danger: oklch(65.32% 0.2389 25.32);
        --theme-danger-foreground: oklch(99.11% 0 0);
        --theme-default: oklch(94% 0.0132 250.36);
        --theme-default-foreground: oklch(21.03% 0.0059 250.36);
        --theme-field-background: oklch(100% 0.0066 250.36);
        --theme-field-foreground: oklch(21.03% 0.0059 250.36);
        --theme-field-placeholder: oklch(55.17% 0.0264 250.36);
        --theme-focus: oklch(62.06% 0.1742 250.36);
        --theme-foreground: oklch(21.03% 0.0059 250.36);
        --theme-muted: oklch(55.17% 0.0264 250.36);
        --theme-overlay: oklch(100% 0.004 250.36);
        --theme-overlay-foreground: oklch(21.03% 0.0059 250.36);
        --theme-scrollbar: oklch(87.1% 0.0132 250.36);
        --theme-segment: oklch(100% 0.0132 250.36);
        --theme-segment-foreground: oklch(21.03% 0.0059 250.36);
        --theme-separator: oklch(92% 0.0132 250.36);
        --theme-success: oklch(73.29% 0.1986 150.39);
        --theme-success-foreground: oklch(21.03% 0.0059 150.39);
        --theme-surface: oklch(100% 0.0066 250.36);
        --theme-surface-foreground: oklch(21.03% 0.0059 250.36);
        --theme-warning: oklch(78.19% 0.1627 71.91);
        --theme-warning-foreground: oklch(21.03% 0.0059 71.91);

        /* ═══════════════════════════════════════════════════════════════════════
           Derived Colors (auto-calculated from theme tokens)
           ═══════════════════════════════════════════════════════════════════════ */
        --theme-accent-hover: color-mix(in oklch, var(--theme-accent) 85%, black);
        --theme-accent-soft: color-mix(in oklch, var(--theme-accent) 15%, var(--theme-background));
        --theme-accent-soft-hover: color-mix(in oklch, var(--theme-accent) 22%, var(--theme-background));
        --theme-default-hover: color-mix(in oklch, var(--theme-default) 85%, black);
        --theme-danger-hover: color-mix(in oklch, var(--theme-danger) 85%, black);
        --theme-danger-soft: color-mix(in oklch, var(--theme-danger) 12%, var(--theme-background));
        --theme-danger-soft-hover: color-mix(in oklch, var(--theme-danger) 18%, var(--theme-background));
        --theme-success-hover: color-mix(in oklch, var(--theme-success) 85%, black);
        --theme-success-soft: color-mix(in oklch, var(--theme-success) 15%, var(--theme-background));
        --theme-warning-hover: color-mix(in oklch, var(--theme-warning) 85%, black);
        --theme-warning-soft: color-mix(in oklch, var(--theme-warning) 15%, var(--theme-background));
        --theme-surface-secondary: color-mix(in oklch, var(--theme-surface) 95%, var(--theme-foreground));
        --theme-surface-tertiary: color-mix(in oklch, var(--theme-surface) 90%, var(--theme-foreground));

        /* ═══════════════════════════════════════════════════════════════════════
           Application Tokens (map to HeroUI theme tokens)
           These are used by components - they reference the theme tokens above
           ═══════════════════════════════════════════════════════════════════════ */
        --background: var(--theme-background);
        --foreground: var(--theme-foreground);
        --primary: var(--theme-accent);
        --primary-foreground: var(--theme-accent-foreground);
        --primary-hover: var(--theme-accent-hover);
        --secondary: var(--theme-default);
        --secondary-foreground: var(--theme-default-foreground);
        --secondary-hover: var(--theme-default-hover);
        --muted: var(--theme-default);
        --muted-foreground: var(--theme-muted);
        --accent: var(--theme-default);
        --accent-foreground: var(--theme-default-foreground);
        --destructive: var(--theme-danger);
        --destructive-foreground: var(--theme-danger-foreground);
        --destructive-hover: var(--theme-danger-hover);
        --destructive-soft: var(--theme-danger-soft);
        --card: var(--theme-surface);
        --card-foreground: var(--theme-surface-foreground);
        --popover: var(--theme-overlay);
        --popover-foreground: var(--theme-overlay-foreground);
        --border: var(--theme-border);
        --input: var(--theme-field-background);
        --ring: var(--theme-focus);
        --separator: var(--theme-separator);

        /* New semantic tokens */
        --success: var(--theme-success);
        --success-foreground: var(--theme-success-foreground);
        --warning: var(--theme-warning);
        --warning-foreground: var(--theme-warning-foreground);
        --field-background: var(--theme-field-background);
        --field-foreground: var(--theme-field-foreground);
        --field-placeholder: var(--theme-field-placeholder);
        --segment: var(--theme-segment);
        --segment-foreground: var(--theme-segment-foreground);
        --scrollbar: var(--theme-scrollbar);

        /* Chart colors */
        --chart-1: oklch(62% 0.19 25);
        --chart-2: oklch(65% 0.15 173);
        --chart-3: oklch(50% 0.1 250);
        --chart-4: oklch(75% 0.15 85);
        --chart-5: oklch(70% 0.18 30);

        /* Node-specific tokens */
        --nodes-combined-signinup: oklch(99.5% 0 0);
        --nodes-claims-exchange: oklch(90% 0.05 220);
        --nodes-group: oklch(95% 0 0);
        --nodes-group-border: oklch(85% 0.02 250);

        /* Flow minimap tokens */
        --flow-minimap-mask: color-mix(in oklch, var(--background) 82%, transparent);
        --flow-minimap-mask-stroke: oklch(20% 0.02 250 / 0.25);
        --flow-minimap-node-surface: var(--card);
        --flow-minimap-node-outline: var(--border);
        --flow-minimap-node-accent: var(--primary);
        --flow-minimap-node-detail: color-mix(in oklch, var(--foreground) 40%, transparent);
        --flow-minimap-group-stroke: var(--nodes-group-border);
        --flow-minimap-group-accent: var(--nodes-group-border);
    }

    .dark,
    [data-theme="dark"] {
        color-scheme: dark;

        /* ═══════════════════════════════════════════════════════════════════════
           HeroUI Theme Colors - Dark Mode
           @see https://v3.heroui.com/docs/react/getting-started/theming
           ═══════════════════════════════════════════════════════════════════════ */
        --theme-accent: oklch(62.06% 0.1742 250.36);
        --theme-accent-foreground: oklch(99.11% 0 0);
        --theme-background: oklch(12% 0.0132 250.36);
        --theme-border: oklch(28% 0.0132 250.36);
        --theme-danger: oklch(59.4% 0.2019 24.21);
        --theme-danger-foreground: oklch(99.11% 0 0);
        --theme-default: oklch(27.4% 0.0132 250.36);
        --theme-default-foreground: oklch(99.11% 0 0);
        --theme-field-background: oklch(21.03% 0.0264 250.36);
        --theme-field-foreground: oklch(99.11% 0 0);
        --theme-field-placeholder: oklch(70.5% 0.0264 250.36);
        --theme-focus: oklch(62.06% 0.1742 250.36);
        --theme-foreground: oklch(99.11% 0 0);
        --theme-muted: oklch(70.5% 0.0264 250.36);
        --theme-overlay: oklch(21.03% 0.0264 250.36);
        --theme-overlay-foreground: oklch(99.11% 0 0);
        --theme-scrollbar: oklch(70.5% 0.0132 250.36);
        --theme-segment: oklch(39.64% 0.0132 250.36);
        --theme-segment-foreground: oklch(99.11% 0 0);
        --theme-separator: oklch(25% 0.0132 250.36);
        --theme-success: oklch(73.29% 0.1986 150.39);
        --theme-success-foreground: oklch(21.03% 0.0059 150.39);
        --theme-surface: oklch(21.03% 0.0264 250.36);
        --theme-surface-foreground: oklch(99.11% 0 0);
        --theme-warning: oklch(82.03% 0.1425 75.92);
        --theme-warning-foreground: oklch(21.03% 0.0059 75.92);

        /* ═══════════════════════════════════════════════════════════════════════
           Derived Colors (auto-calculated from theme tokens)
           ═══════════════════════════════════════════════════════════════════════ */
        --theme-accent-hover: color-mix(in oklch, var(--theme-accent) 80%, white);
        --theme-accent-soft: color-mix(in oklch, var(--theme-accent) 20%, var(--theme-background));
        --theme-accent-soft-hover: color-mix(in oklch, var(--theme-accent) 28%, var(--theme-background));
        --theme-default-hover: color-mix(in oklch, var(--theme-default) 80%, white);
        --theme-danger-hover: color-mix(in oklch, var(--theme-danger) 80%, white);
        --theme-danger-soft: color-mix(in oklch, var(--theme-danger) 18%, var(--theme-background));
        --theme-danger-soft-hover: color-mix(in oklch, var(--theme-danger) 25%, var(--theme-background));
        --theme-success-hover: color-mix(in oklch, var(--theme-success) 80%, white);
        --theme-success-soft: color-mix(in oklch, var(--theme-success) 20%, var(--theme-background));
        --theme-warning-hover: color-mix(in oklch, var(--theme-warning) 80%, white);
        --theme-warning-soft: color-mix(in oklch, var(--theme-warning) 20%, var(--theme-background));
        --theme-surface-secondary: color-mix(in oklch, var(--theme-surface) 90%, var(--theme-foreground));
        --theme-surface-tertiary: color-mix(in oklch, var(--theme-surface) 80%, var(--theme-foreground));

        /* Application tokens automatically inherit from theme tokens */

        /* Chart colors - adjusted for dark mode */
        --chart-1: oklch(60% 0.18 250);
        --chart-2: oklch(60% 0.15 160);
        --chart-3: oklch(70% 0.16 50);
        --chart-4: oklch(65% 0.16 300);
        --chart-5: oklch(65% 0.18 350);

        /* Node-specific tokens - dark mode */
        --nodes-combined-signinup: oklch(8% 0 0);
        --nodes-claims-exchange: oklch(30% 0.04 220);
        --nodes-group: oklch(15% 0 0);
        --nodes-group-border: oklch(35% 0.02 250);

        /* Flow minimap tokens - dark mode */
        --flow-minimap-mask: color-mix(in oklch, var(--background) 60%, transparent);
        --flow-minimap-mask-stroke: oklch(100% 0 0 / 0.35);
        --flow-minimap-node-detail: color-mix(in oklch, var(--foreground) 60%, transparent);
    }

    /* https://reactflow.dev/learn/customization/theming */
    .react-flow {
        --xy-minimap-background-color: var(--background);
        --xy-background-color: transparent;
        --xy-minimap-node-background-color: var(--muted-foreground);
        --xy-attribution-background-color: var(--background);
        --xy-controls-button-background-color: var(--background);
        --xy-controls-button-border-color: var(--border);
        --xy-controls-button-background-color-hover: var(--accent);

        .react-flow__attribution {
            @apply rounded-md backdrop-blur-sm bg-background/30;
        }

        .react-flow__minimap-svg {
            @apply rounded-lg backdrop-blur-sm;
        }
    }

    .flow-minimap {
        @apply rounded-xl border bg-background/80 backdrop-blur-sm shadow-xl ring-1 ring-black/5;
        min-width: 11rem;
    }

    .flow-minimap svg {
        width: 12rem !important;
        height: 9.5rem !important;
    }

    .flow-minimap__shape {
        filter: drop-shadow(0 1px 3px rgba(15, 23, 42, 0.35));
    }

    .dark .flow-minimap__shape {
        filter: drop-shadow(0 1px 3px rgba(0, 0, 0, 0.65));
    }

    .flow-minimap__node text {
        font-family:
            "Inter",
            "Segoe UI",
            system-ui,
            -apple-system,
            BlinkMacSystemFont,
            sans-serif;
        letter-spacing: 0.02em;
    }
}

@layer base {
    * {
        @apply border-border;
    }

    body {
        @apply bg-background text-foreground;
    }
}

/* fixes reactflow bug with no border on last child element */
.react-flow__controls-button:last-child {
    @apply border-b;
    border-bottom: 1px solid
        var(
            --xy-controls-button-border-color-props,
            var(--xy-controls-button-border-color, var(--xy-controls-button-border-color-default))
        );
}

.react-flow__edge-textbg {
    @apply fill-background/90 rounded-md p-4;
}

.react-flow__edge-text {
    @apply font-mono text-lg text-foreground backdrop-blur-sm m-4 bg-background;
}

/* Ensure edge labels render above everything */
.react-flow__edge-label-renderer {
    z-index: 1000 !important;
}
